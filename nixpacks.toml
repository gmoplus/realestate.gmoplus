# Flynax Real Estate - Coolify/Nixpacks Configuration
# PHP Built-in Server kullanarak çalışır

[phases.setup]
nixPkgs = [
    "php83",
    "php83Extensions.mbstring",
    "php83Extensions.gd",
    "php83Extensions.pdo",
    "php83Extensions.pdo_mysql",
    "php83Extensions.mysqli",
    "php83Extensions.zip",
    "php83Extensions.curl",
    "php83Extensions.xml",
    "php83Extensions.bcmath",
    "php83Extensions.intl",
    "php83Extensions.opcache",
    "mariadb-client"
]

[phases.build]
cmds = [
    # Tüm gerekli dizinleri oluştur
    "mkdir -p tmp/compile tmp/aCompile tmp/cache tmp/cache_1893581862 tmp/upload tmp/errorLog files plugins",
    
    # İzinleri ayarla
    "chmod -R 777 tmp files plugins",
    
    # Eski compile dosyalarını temizle
    "rm -f tmp/compile/*.php tmp/aCompile/*.php",
    
    # .htaccess ve index.html dosyalarını oluştur (güvenlik)
    "touch tmp/.htaccess tmp/index.html",
    "echo 'deny from all' > tmp/.htaccess"
]

[start]
cmd = "rm -f /app/tmp/compile/*.php /app/tmp/aCompile/*.php && php -S 0.0.0.0:${PORT:-80} -t /app /app/router.php"
