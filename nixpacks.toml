# Flynax Real Estate - Coolify/Nixpacks Configuration
# Bu dosya PHP uygulamasını Apache ile çalıştırır

[phases.setup]
nixPkgs = [
    "php83", 
    "php83Extensions.mbstring", 
    "php83Extensions.gd", 
    "php83Extensions.pdo", 
    "php83Extensions.pdo_mysql", 
    "php83Extensions.mysqli", 
    "php83Extensions.zip", 
    "php83Extensions.curl", 
    "php83Extensions.xml", 
    "php83Extensions.bcmath", 
    "php83Extensions.intl",
    "php83Extensions.session",
    "php83Extensions.opcache",
    "mariadb-client",
    "apache"
]

[phases.build]
cmds = [
    # Create required directories
    "mkdir -p tmp/compile tmp/cache tmp/upload files plugins",
    "chmod -R 777 tmp",
    "chmod -R 777 files",
    "chmod -R 777 plugins",
    
    # Create favicon if missing
    "touch favicon.ico",
    
    # Create Apache configuration
    "mkdir -p /etc/apache2/sites-available",
    "echo 'ServerName localhost' > /etc/apache2/conf-available/servername.conf"
]

[phases.install]
cmds = [
    # Configure PHP
    "mkdir -p /etc/php/8.3/apache2/conf.d",
    "echo 'session.save_path = /tmp' > /etc/php/8.3/apache2/conf.d/99-flynax.ini",
    "echo 'memory_limit = 512M' >> /etc/php/8.3/apache2/conf.d/99-flynax.ini",
    "echo 'upload_max_filesize = 64M' >> /etc/php/8.3/apache2/conf.d/99-flynax.ini",
    "echo 'post_max_size = 64M' >> /etc/php/8.3/apache2/conf.d/99-flynax.ini",
    "echo 'max_execution_time = 300' >> /etc/php/8.3/apache2/conf.d/99-flynax.ini"
]

[start]
cmd = "rm -f /app/tmp/compile/*.php && php -S 0.0.0.0:${PORT:-80} -t /app"
